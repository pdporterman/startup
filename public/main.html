<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="icon" href="images/magnifying-glass.ico" />

    <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css"
  />
  <link
    rel="stylesheet"
    href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css"
  />
  <script defer src="https://code.jquery.com/jquery-3.7.0.js"></script>
  <script
    defer
    src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js">
  </script>
  <script
    defer
    src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js">
  </script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"> 
  </script>
  <script>
    fetch("/api/score") // path to JSON
      .then((response) => response.json())
      .then((data) => {
            data.sort((a, b) => a.moves - b.moves); 
            data.forEach((row, index) => {
              if (index === 0) {
                row.rank = 1;
              } else if (row.moves === data[index - 1].moves) {
                row.rank = data[index - 1].rank;
              } else {
                row.rank = data[index - 1].rank + 1;
              }
            });
            data.forEach((row) => {
              $("#example").append(
                "<tr>" +
                  "<td>" + row.rank + "</td>" +
                  "<td>" + row.moves + "</td>" +
                  "<td>" + row.username + "</td>" + 
                "</tr>"
              );
            });
            $(document).ready(function () {
              $("#example").DataTable({
                  autoWidth: true,
                  scrollY: true,
                  scrollX: true,
                  dom: '<lf<t>Bip>',
                  lengthMenu: [
                    [10,20,25,50,-1], 
                    [10,20,25,50,"All"]
                  ],
                  columnDefs: [
                    {"width" : "100px", "targets": 0},
                    {"width" : "250px", "targets": 1},
                  ],
                  buttons: [
                    'csv', 
                    {
                      extend: 'pdfHtml5',
                      orientation: 'landscape',
                      pageSize: 'LEGAL'
                    },
                  ],
                });
              });
            });

    fetch('https://v2.jokeapi.dev/joke/Programming?blacklistFlags=nsfw,religious,political,racist,sexist,explicit')
            .then(res=>res.json())
            .then(jokeData=>{
              if (jokeData.type == 'single'){
                console.log(jokeData.joke);
              } else{
                console.log(jokeData.setup);
                console.log('...');
                setTimeout(()=>console.log('\t- '+jokeData.delivery), 5000);
              }
            });
  </script>
 
    <link rel="stylesheet" href="style.css" />
</head>

<body>
    <header>
    <h1>Score Board</h1> 
    </header> 
    
    <main>
    
    <div class="container py-5 px-5  w-50" id="container">
        <table id="example" class="table table-striped hover" style="width: 100%">
          <thead>
            <tr>
              <th>Rank</th>
              <th>Moves</th>
              <th>Username</th>
            </tr>
          </thead>
          <tbody>
            <!-- JSON data -->
          </tbody>
          <tfoot>
            <tr>
              <th>Rank</th>
              <th>Moves</th>
              <th>Username</th>
            </tr>
          </tfoot>
        </table>
      </div>


    
        <a href="play.html" class="btn btn-danger btn-lg">Play Game!</a>
        <a href="/auth/logout" class="btn btn-primary btn-sm border-white">Log Out</a>
      </main>
      </body>

<footer>
    <a href="https://github.com/pdporterman/startup" class="btn btn-warning"> GitHub</a>
</footer>
</html>